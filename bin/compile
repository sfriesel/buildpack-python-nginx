#!/bin/bash
set -e

readonly BUILD_DIR="$1"
readonly CACHE_DIR="$2"
readonly BP_DIR="$(dirname "$(dirname "$(readlink -f "$0")")")"

mkdir -p "$CACHE_DIR"

mkdir -p "$CACHE_DIR/nginx"
$BP_DIR/parts/nginx/bin/compile "$1" "$CACHE_DIR/nginx"

mkdir -p "$CACHE_DIR/python"
$BP_DIR/parts/python/bin/compile "$1" "$CACHE_DIR/python"

$CC -o nginx-wrapped "$BP_DIR/wrap.c"
